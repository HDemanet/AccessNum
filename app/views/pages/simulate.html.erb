<div data-controller="simulate" class="container mt-4">
  <h2 class="text-center">Simulateur</h2>

  <% if params[:url].present? %>
    <p class="text-center text-muted">
      Sélectionnez une particularité pour voir comment le site est perçu par différents utilisateurs.
    </p>
    <div class="row mt-4">
      <div class="col-12 text-center mb-3">
        <div class="btn-group d-flex flex-wrap justify-content-center">
          <button data-action="click->simulate#toggle" data-type="daltonisme" class="btn btn-outline-primary m-2">
            🎨 Daltonisme
          </button>
          <button data-action="click->simulate#toggle" data-type="dmla" class="btn btn-outline-primary m-2">
            👀 DMLA
          </button>
          <button data-action="click->simulate#toggle" data-type="cataracte" class="btn btn-outline-primary m-2">
            🌫️ Cataracte
          </button>
          <button data-action="click->simulate#toggle" data-type="cecité" class="btn btn-outline-primary m-2">
            🚫 Cécité
          </button>
          <button data-action="click->simulate#toggle" data-type="moteur" class="btn btn-outline-primary m-2">
            ⌨️ Handicap moteur
          </button>
          <button data-action="click->simulate#toggle" data-type="cognitif" class="btn btn-outline-primary m-2">
            🧠 Handicap cognitif
          </button>
        </div>
      </div>
    </div>

    <div class="row mt-3">
      <div class="col-md-7">
        <iframe data-simulate-target="iframe" id="preview" class="w-100 border rounded shadow"
                src="<%= params[:url] %>" title="Aperçu du site testé" onerror="this.classList.add('d-none'); document.getElementById('iframe-error').classList.remove('d-none');"></iframe>
        <p id="iframe-error" class="text-danger text-center mt-2 d-none">⚠️ Ce site ne peut pas être affiché en iframe.</p>
      </div>

      <div class="col-md-5">
        <div class="mt-3 p-3 border rounded bg-light">
          <h4 data-simulate-target="title" class="text-primary">Sélectionnez une simulation</h4>
          <p data-simulate-target="description" class="text-muted">
            Cliquez sur un bouton pour voir les effets.
          </p>
        </div>
      </div>
    </div>
  <% end %>

  <%= form_tag simulate_path, method: :get, class: "mt-4" do %>
    <p>Pour vous mettre dans la peau de divers utilisateurs, veuillez insérer une URL.</p>
    <div class="input-group">
      <%= text_field_tag :url, params[:url], class: "form-control custom-placeholder", placeholder: "Entrez l'URL d'un site web" %>
      <button class="btn custom-btn" type="submit">Simuler</button>
    </div>
  <% end %>
</div>
